version: 0.2

phases:

  install:
    runtime-versions:
      dotnet: 8.x

    commands:
      - export PATH="$PATH:/root/.dotnet/tools"
      - dotnet tool install --global PowerShell --version 7.4.13
      - curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
      - export PATH="$PATH:$HOME/.cargo/bin"

  pre_build:
    commands:
      - pwsh -command '$PSVersionTable'
      - cargo --version
      - pwsh -command './configure_aws_credential.ps1'
      - pwsh -command './install_nuget.ps1'
      - pwsh -command './install_modules.ps1'

  build:
    commands:
      - pwsh -command 'Invoke-Build'

artifacts:
  files:
    - '**/*'
  base-directory: 'DeploymentArtifacts'

reports:
  UnitTests:
    files:
      - 'test_report.xml'
    discard-paths: yes
    file-format: JUNITXML
  PostBuildTests:
    files:
      - 'test_report_build.xml'
    discard-paths: yes
    file-format: JUNITXML
